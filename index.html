<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Hello World!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
    <script src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
  </head>
  <body>
    <section class="hero is-primary is-medium">
      <!-- Hero head: will stick at the top -->
      <div class="hero-head">
        <nav class="navbar">
          <div class="container">
            <div class="navbar-brand">
              <a class="navbar-item">
                <span>Configure</span>
              </a>
              <span class="navbar-burger burger" data-target="navbarMenuHeroA">
                <span></span>
                <span></span>
                <span></span>
              </span>
            </div>
            <div id="navbarMenuHeroA" class="navbar-menu">
              <div class="navbar-end">
                <span class="navbar-item">
                  <a class="button is-primary is-inverted">
                    <span class="icon">
                      <i class="fab fa-times-circle"></i>
                    </span>                    
                  </a>
                </span>
              </div>
            </div>
          </div>
        </nav>
      </div>
    
      <!-- Hero content: will be in the middle -->
      <div class="hero-body">
        <div class="tile is-vertical is-3">
          <div class="tile">
            <div class="tile is-parent is-vertical">
              <div class="field">
                <label class="label">Username</label>
                <div class="control has-icons-left has-icons-right">
                  <input class="input" id="username" type="text" placeholder="Azure Devops or TFS username" />
                </div>
                <p class="help is-success">Azure Devops or TFS username</p>
              </div>
              <div class="field">
                <label class="label">PAT</label>
                <div class="control has-icons-left has-icons-right">
                  <input class="input" id="pat" type="text" placeholder="Personal Access Token" />
                </div>
                <p class="help is-success">Where do I find this?</p>
              </div>
              <div class="field">
                <label class="label">Poll Interval</label>
                <div class="control">
                  <input class="input" id="pollInterval" type="text" />
                </div>
              </div>
              <div class="field">
                <label class="label">Failure Threshold</label>
                <div class="control">
                  <input class="input" id="failureThreshold" type="text" />
                </div>
              </div>            
              <div class="control">
                <button id="verify" class="button is-link is-right">Verify Credentials</button>
              </div>
            </div>
          </div>
        </div>
        <div class="tile is-vertical is-3">
          <h1 class="title">TFS Settings</h1>
          <div class="tile">
            <div class="tile is-parent is-vertical">
              <div class="field">
                <label class="label">Instance</label>
                <div class="control">
                  <input class="input" id="tfs.instance" type="text" />
                </div>
              </div>
              <div class="field">
                <label class="label">Collection</label>
                <div class="control">
                  <input class="input" id="tfs.collection" type="text" />
                </div>
              </div>
              <div class="field">
                <label class="label">Project</label>
                <div class="control">
                  <input class="input" id="tfs.project" type="text" />
                </div>
                <p class="help is-success">Where do I find this?</p>
              </div>
              <div class="dropdown">
                <div class="dropdown-trigger">
                  <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
                    <span>Release</span>
                    <span class="icon is-small">
                      <i class="fas fa-angle-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu" role="menu">
                  <div class="dropdown-content">
                    <a href="#" class="dropdown-item">Dropdown item</a>
                    <a class="dropdown-item">Other dropdown item</a>
                    <a href="#" class="dropdown-item is-active">Active dropdown item</a>
                    <a href="#" class="dropdown-item">Other dropdown item</a>
                    <hr class="dropdown-divider" />
                    <a href="#" class="dropdown-item">With a divider</a>
                  </div>
                </div>
              </div>
              <div class="control">
                <button id="save" class="button is-link is-right">Save</button>
              </div>
            </div>
          </div>
        </div> 
      </div>    

    </section>

    <script type='text/javascript'>
      const lib = require('./lib')
      const log = require('electron-log');
      document.addEventListener('DOMContentLoaded',pageLoaded);

      function pageLoaded(){
          console.log('The page is loaded')       
          const appConfig = lib.getConfig('./config.json')
          document.getElementById('username').value = appConfig.username
          document.getElementById('pat').value = appConfig.pat
          document.getElementById('pollInterval').value = appConfig.pollInterval
          document.getElementById('failureThreshold').value = appConfig.failureThreshold          

          if(appConfig.tfsOrazure == "tfs") {
            document.getElementById('tfs.instance').value = appConfig.tfs.instance 
          } else if(appConfig.tfsOrazure == "azure") {

          } else {
            log.error('Failed to load config - tfs or devOps azure not defined')
          }
      }

      require('electron').ipcRenderer.on('some_js_Method', (event, message) => {
        console.log(message)  // Prints 'window created!'
      })

      document.getElementById('verify').onclick = function(){
        console.log('yooooooooooooooooooooooooo')
      }

      document.getElementById('save').onclick = function(){
        console.log('Save clicked')
        const appConfig = {
          username: document.getElementById('username').value,
          
        }
        var validationResult = lib.validateConfig(appConfig)

        if(!validationResult.hasErrors) {
          lib.setConfig(appConfig)
        } else {
          console.log('TODO - show bulma error here', validationResult.errors)
        }        
      }   
    </script>  
  </body>
</html>